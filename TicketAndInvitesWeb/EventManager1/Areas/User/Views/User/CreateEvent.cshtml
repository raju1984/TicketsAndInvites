@model EventManager1.Models.Event_
@{
    ViewBag.Title = "CreateEvent";
    Layout = "~/Areas/User/Views/Shared/_UserLayout.cshtml";
    <style type="text/css">
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin: 0;
        }
        @@media all and (min-width: 320px) and (max-width: 480px) {
            input#add {
                width: 100% !important;
            }
           
            .content-wrapper {
                background: #f2edf3;
                padding: 2.75rem 1.25rem 0 !important;
            }
            .card .card-body {
    padding: 2.5rem 1.5rem !important;
}
        }
        .tag {
            top: 0px !important;
            right: 20px !important;
            opacity: 0.7;
            cursor: pointer
        }
        
            #map {
            width: 100%;
            height: 450px;
        }

        .form-control {
            padding: 0.275rem 1.175rem;
        }

        .btn {
            padding: 0.585rem 1.0rem;
            /*background-color: transparent;*/
        }

        .error {
            color: red;
            visibility: hidden
        }

        .imgbox {
            width: 100%;
            height: 100%;
            margin-bottom: 10px
        }
    </style>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f1f1f1;
        }

        #regForm {
            background-color: #ffffff;
            margin: 0px auto;
            font-family: Raleway;
            padding: 40px;
            width: 100%;
            min-width: 300px;
        }

        h1 {
            text-align: center;
        }

        input {
            padding: 10px;
            width: 100%;
            font-size: 17px;
            font-family: Raleway;
            border: 1px solid #aaaaaa;
        }

            /* Mark input boxes that gets an error on validation: */
            input.invalid {
                border: 1px solid #e14949;
                /*background-color: #fbb2b2;*/
            }

            input#add {
                width: 15%;
            }

        /* Hide all steps by default: */
        .tab {
            display: none;
        }

        button {
            background-color: #4CAF50;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            font-size: 17px;
            font-family: Raleway;
            cursor: pointer;
        }

            button:hover {
                opacity: 0.8;
            }

        #prevBtn {
            background-color: #bbbbbb;
        }

        /* Make circles that indicate the steps of the form: */
        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
        }

            .step.active {
                opacity: 1;
            }

            /* Mark the steps that are finished and valid: */
            .step.finish {
                background-color: #4CAF50;
            }
        @@media screen and (min-width: 320px) and (max-width: 480px) {
            input#StartDate {
                width: 100%;
                margin-bottom: 10px;
            }
            input#EndDate {
                width: 100%;
                margin-bottom: 10px;
            }
            input#NamerRSVP {
                width: 100%;
                margin-bottom: 10px;
            }
            input.form-control.name {
                width: 100%;
                margin-bottom: 10px;
            }
            input#FileUpload1 {
                width: 100%;
                margin-bottom: 10px;
            }
            input#FileUpload2 {
                width: 100%;
                margin-bottom: 10px;
            }
            select#CountryId {
                width: 100%;
                margin-bottom: 10px;
            }
            input#lat {
                width: 100%;
                margin-bottom: 10px;
            }
            input#lng {
                width: 100%;
                margin-bottom: 10px;
            }
            input#CityName {
                width: 100%;
                margin-bottom: 10px;
            }
            input#AddressLine {
                width: 100%;
                margin-bottom: 10px;
            }
            input#Venue {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
}

<div class="content-wrapper">
    <input type="hidden" id="hfzipcode" />
    <div class="page-header">
        <h3 class="page-title">
            <span class="page-title-icon bg-gradient-primary text-white mr-2">
                <i class="mdi mdi-calendar-plus menu-icon"></i>
            </span>
            Create Event
        </h3>
    </div>
    <form enctype="multipart/form-data" name="registration">
        <div class="tab">
            <div class="row">
                <div class="col-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <p class="card-description">
                                Name your event and tell event-goers why they should come. Add details that
                                highlight what makes it unique.
                            </p>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Event name</label>
                                        @Html.TextBoxFor(p => p.EventName, new { @class = "form-control", @placeholder = "Event Name" })
                                        <span class="error col-md-12" id="Nameerr">Event Name is required</span>
                                    </div>
                                </div>
                                @*<div class="col-md-6">
                                    <div class="form-group">
                                        <label for="">Date to publish event</label>
                                        <div class="input-group">
                                            @Html.TextBoxFor(model => model.PublishDate, new { @type = "date", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>*@
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="">Event starts at</label>
                                        <div class="input-group">
                                            @Html.TextBoxFor(model => model.StartDate, new { @type = "date", @class = "form-control" })
                                            @Html.TextBoxFor(model => model.StartTime, new { type = "time", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="">Ends at</label>
                                        <div class="input-group">
                                            @Html.TextBoxFor(model => model.EndDate, new { @type = "date", @class = "form-control" })
                                            @Html.TextBoxFor(model => model.EndTime, new { type = "time", @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div id="orderItems">
                                        <table class="table table-responsive" id="orderdetailsItems"></table>
                                        <span id="orderItemError" style="color:red"></span>
                                    </div>
                                    <table class="mycontainer col-md-12" id="mainrow">

                                        <tr>
                                            <td>
                                                <div class="form-group ">
                                                    <label for="">RSVP</label>
                                                    <div class="input-group">
                                                        <input type="text" aria-label="" id="NamerRSVP"
                                                               placeholder="Contact Person Name or Email"
                                                               class="form-control name">
                                                        <input type="number" aria-label="" id="PhoneRSVP"
                                                               placeholder="Contact person Phone number"
                                                               class="form-control phone">

                                                    </div>
                                                    <div class="input-group"><div class="error col-md-6" id="NamerRSVPerr">Contact Person Name or Email required</div><div class="error col-md-6" id="PhoneRSVPerr">Contact person Phone number required</div></div>
                                                </div>
                                                <div class="col-md-12 text-right" style="padding:0" >
                                                    <input type="button" id="add" value="Add more RSVP" class="btn btn-primary btn-sm" />
                                                    @*<a href="#" class="btn btn-primary btn-sm">Add more RSVP</a>*@
                                                </div>
                                            </td>
                                        </tr>
                                    </table>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Description</label>
                                        <textarea class="form-control" id="Description" rows="10"></textarea>

                                    </div>
                                    <div class="form-group error" id="Descriptionerr">Description required</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="">Venue</label>
                        <div class="input-group">
                            @Html.DropDownList("Id", new SelectList(ViewBag.country, "Id", "Name"), "Please select a country", new { @id = "CountryId", @class = "form-control" })
                            @Html.TextBoxFor(model => model.CityName, new { @class = "form-control", @placeholder = "City" })
                            @Html.TextBoxFor(model => model.address_.FirstOrDefault().AddressLine, new { @class = "form-control", @placeholder = "Address" })
                            @Html.TextBoxFor(model => model.Venue, new { @class = "form-control", @placeholder = "Venue Name" })
                        </div>
                        <div class="input-group">
                            <div class="error col-md-3" id="CountryIderr">Please select a country</div><div class="error col-md-3" id="Cityerr">City Name required</div>
                            <div class="error col-md-3" id="addresserr">Address required</div><div class="error col-md-3" id="Venueerr">Venue Name required</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-5">
                <div class="col-md-12">
                    <label for="">Enter Geo Location</label>
                    <div class="input-group">
                        <input type="text" aria-label="" placeholder="longitude" id="lat"
                               class="form-control">
                        <input type="number" aria-label="" placeholder="latitude" id="lng"
                               address""="" class="form-control">

                    </div>
                    <p><small>Or Drang and drop the location on the map</small> </p>
                </div>
                <div class="col-md-12">
                    <span id="spnaddress"></span>
                    <div id="map"></div>
                </div>
            </div>
        </div>
        <div class="tab">
            <div class="row mt-5">
                <div class="col-md-12">
                    <h3>Image</h3>
                    <p>
                        A great image speaks louder than words, as long as it's a PNG, JPG or
                        GIF file. For best
                        results, use a high-resolution image. Images with as little text as
                        possible work best.
                    </p>
                    <div class="input-group col-xs-12">
                        <input type="file" id="FileUpload1" class="form-control file-upload-info" name="files0[]" multiple />
                        <span class="input-group-append">
                            <input type="button" id="btnUpload" value="Upload Images" class="file-upload-browse btn btn-gradient-primary" />
                        </span>
                    </div>

                    <h5 class="mt-4"> Uploaded Images </h5>
                </div>
                <div class="col-md-4">
                    <div class="tag" id="ImgRemove1">
                        <h6 class="noMargin text-success">
                           <span>X</span>
                        </h6>
                    </div>
                    <div style="height:200px; margin-bottom:10px">
                        <img src="../../images/placeholder-image.jpg" id="img1"
                             class="imgbox" alt="">
                    </div>
                    <div><input type="radio" name="mainpic" value="img1" id="img1c" style="width:20px" checked> Select as main picture</div>
                </div>
                <div class="col-md-4">
                    <div class="tag" id="ImgRemove2">
                        <h6 class="noMargin text-success">
                            <span>X</span>
                        </h6>
                    </div>
                    <div style="height:200px; margin-bottom:10px">
                        <img src="../../images/placeholder-image.jpg" id="img2"
                             class="imgbox" alt="">
                    </div>

                    <div>
                        <input type="radio" name="mainpic" value="img2" id="img2c" style="width:20px"> Select as main picture
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="tag" id="ImgRemove3">
                        <h6 class="noMargin text-success">
                            <span>X</span>
                        </h6>
                    </div>
                    <div style="height:200px;margin-bottom:10px">
                        <img src="../../images/placeholder-image.jpg" id="img3"
                             class="imgbox" alt="">
                    </div>
                    <div>
                        <input type="radio" name="mainpic" value="img3" id="img3c" style="width:20px"> Select as main picture
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-md-12">
                    <h3>Video</h3>

                    <div class="input-group col-xs-12">
                        <input type="file" id="FileUpload2" class="form-control file-upload-info" name="files1[]" />
                        <span class="input-group-append">
                            <input type="button" id="btnUploadvid" accept="video/*" value="Upload Video" class="file-upload-browse btn btn-gradient-primary" />
                        </span>
                    </div>
                </div>
                <div class="col-md-12 mt-4 text-center">
                    <video width="80%" height="300" id="video1" controls>
                        <source src="" type="video/mp4" id="videopath">
                        <source src="" type="video/ogg" id="videogg">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
        </div>
        <div style="overflow:auto;">
            <div style="float:right;">
                <button type="button" style=" background: linear-gradient(to right, #ffbf96, #fe7096);"
                        id="prevBtn" onclick="nextPrev(-1)">
                    Previous
                </button>
                <button type="button" style=" background: linear-gradient(to right, #ffbf96, #fe7096);"
                        id="nextBtn" onclick="nextPrev(1)">
                    Next
                </button>
            </div>
        </div>
        <div style="text-align:center;margin-top:40px;">
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>

        </div>

        <input type="hidden" id="eventid" value="0" />
        <input type="hidden" id="companyId" value="0" />

        @*<div class="row mt-5">
                <div class="col-md-12 text-center">
                    <input id="submit" type="button" value="Publish" class="btn btn-gradient-danger btn-rounded btn-fw" />

                </div>
            </div>*@

    </form>
</div>

@section Scripts
{
    <script>
        var currentTab = 0; // Current tab is set to be the first tab (0)
        showTab(currentTab); // Display the current tab

        function showTab(n) {
            // This function will display the specified tab of the form...
            var x = document.getElementsByClassName("tab");
            x[n].style.display = "block";
            //... and fix the Previous/Next buttons:
            if (n == 0) {
                document.getElementById("prevBtn").style.display = "none";
            } else {
                if (!$("#map .gm-style").length) {
                    $("#map").css("height", "0px");
                }
                document.getElementById("prevBtn").style.display = "inline";
            }
            if (n == (x.length - 1)) {
                document.getElementById("nextBtn").innerHTML = "Publish";
            }
            else {
                document.getElementById("nextBtn").innerHTML = "Next";
            }
            //... and run a function that will display the correct step indicator:
            fixStepIndicator(n)
        }

        function nextPrev(n) {
            debugger;
            var btn = document.getElementById("nextBtn").innerHTML;
            if (currentTab == 2 && btn == "Publish" && n != -1) { Publishevent();}
            // This function will figure out which tab to display
            var x = document.getElementsByClassName("tab");
            // Exit the function if any field in the current tab is invalid:
            if (n == 1 && !validateForm()) { return false; };
            // Hide the current tab:
            x[currentTab].style.display = "none";
            // Increase or decrease the current tab by 1:
            currentTab = currentTab + n;
            // if you have reached the end of the form...
            if (currentTab >= x.length) {
                // ... the form gets Publishted:
                document.getElementById("regForm").Publish();
                return false;
            }

            // Otherwise, display the correct tab:
            showTab(currentTab);
        }
        $(function () {
            var dtToday = new Date();
            var month = dtToday.getMonth() + 1;
            var day = dtToday.getDate();
            var year = dtToday.getFullYear();
            if (month < 10)
                month = '0' + month.toString();
            if (day < 10)
                day = '0' + day.toString();

            var maxDate = year + '-' + month + '-' + day;
            //alert(maxDate);
            $('#PublishDate').attr('min', maxDate);
            $('#StartDate').attr('min', maxDate);
            $('#EndDate').attr('min', maxDate);
        });
        function validateForm() {
            debugger;
            // This function deals with validation of the form fields
            var x, y, i, valid = true;
            x = document.getElementsByClassName("tab");
            y = x[currentTab].getElementsByTagName("input");
            // A loop that checks every input field in the current tab:
            var Id = $('#eventid').val();
            if (Id = 0) {
                var pdate = $("#PublishDate").val();
                var sdate = $("#StartDate").val();
                var edate = $("#EndDate").val();
                var d = new Date();
                var strDate = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
                if (new Date(edate) < new Date(sdate)) {//compare end <=, not >=
                    //your code here
                    alertify.alert("End date can't less than strat date");
                    valid = false;
                }
                else if (new Date(pdate) >= new Date(strDate)) {//compare end <=, not >=
                    //your code here
                    alertify.alert("Publish date can't less than today");
                    valid = false;
                }
                else if (new Date(sdate) >= new Date(strDate)) {//compare end <=, not >=
                    //your code here
                    alertify.alert("Start date can't less than today");
                    valid = false;
                }
            }
            for (i = 0; i < y.length; i++) {
                // If a field is empty...

                if (y[i].value == "") {
                    // add an "invalid" class to the field:
                    y[i].className += " invalid";
                    // and set the current valid status to false
                    valid = false;
                    }

            }
            // If the valid status is true, mark the step as finished and valid:
            if (valid) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid; // return the valid status
        }

        function fixStepIndicator(n) {
            // This function removes the "active" class of all steps...
            var i, x = document.getElementsByClassName("step");
            for (i = 0; i < x.length; i++) {
                x[i].className = x[i].className.replace(" active", "");
            }
            //... and adds the "active" class on the current step:
            x[n].className += " active";
        }
        function Publishevent() {
            debugger;
            var isAllValid = validateform();
            if (isAllValid) {
                var radioValue = $("input[name='mainpic']:checked").val();
                var list = [];
                var img = "../../images/placeholder-image.jpg";
                var img11 = $('#img1').attr('src');
                var img1checked = false;
                if (radioValue == 'img1') { img1checked = true }
                var img21 = $('#img2').attr('src');
                var img2checked = false;
                if (radioValue == 'img2') { img2checked = true }
                var img31 = $('#img3').attr('src');
                var img3checked = false;
                if (radioValue == 'img2') { img3checked = true }
                var img1 = {
                    URL: $('#img1').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img1checked
                }
                if (img11 != img)
                    list.push(img1);
                var img2 = {
                    URL: $('#img2').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img2checked
                }
                if (img21 != img)
                    list.push(img2);
                var img3 = {
                    URL: $('#img3').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img3checked
                }
                if (img31 != img)
                    list.push(img3);
                var vid1 = {
                    URL: $('video').find('Source:first').attr('src'),
                    Mul_Type: 2
                }
                list.push(vid1);
                var Address = [];
                var addr = {
                    longitude: $('#lat').val(),
                    latitude: $('#lng').val(),
                    Country: $('#CountryId').val(),
                    City: $('#CityName').val(),
                    AddressLine: $('#AddressLine').val(),
                    ZipCode: $('#ZipCode').val()
                }
                Address.push(addr);
                var rsvp = [];
                var Rsvp = {
                    Namer: $('#NamerRSVP').val(),
                    Phone: $('#PhoneRSVP').val(),
                }
                if (Rsvp) {
                    rsvp.push(Rsvp);
                }
                $('#orderdetailsItems tbody tr').each(function (index, ele) {
                    var Rsvp1 = {
                        Namer: $('.name', this).val(),
                        Phone: $('.phone', this).val(),
                    }
                    rsvp.push(Rsvp1);
                })
                //validate order items
                debugger;
                Loader(true);
                var Register = {
                    Id: $('#eventid').val(),
                    BusinessOwner_Id: $('#companyId').val(),
                    EventName: $('#EventName').val(),
                    PublishDate: $('#PublishDate').val(),
                    StartDate: $('#StartDate').val(),
                    StartTime: $('#StartTime').val(),
                    EndDate: $('#EndDate').val(),
                    EndTime: $('#EndTime').val(),
                    Venue: $('#Venue').val(),
                    Description: $('#Description').val(),
                    address_: Address,
                    Multimedia: list,
                    Rsvp: rsvp
                }
                //$(this).val('Please wait...');
                console.log(Register);
                debugger;
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CreateEvent", "User", new { area = "User" })',
                    data: '{Register: ' + JSON.stringify(Register) + '}',/* JSON.stringify(Register),*/
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (resp) {
                        if (resp.result.Code == 200) {
                            debugger;
                            //alert('Successfully saved');
                            //here we will clear the form
                            list = [];
                            $('#UserName,#ContactNo,#Email,#Password,#BusinessName,#CountryId,#Address,#ZipCode,#LastName,#FirstName,#PhoneNo,#confPassword').val('');
                            $('#orderdetailsItems').empty();
                            alertify.alert("Event Created Successfully.");
                            Loader(false);
                            setTimeout(function () {
                                window.location.replace("../InvitationUser/Index");
                            }, 2000); 
                            
                        }
                        else {
                            Loader(false);
                            alertify.alert(resp.result.Msg);
                        }
                    },
                    error: function (error) {
                        Loader(false);
                        alertify.alert(error);
                    }
                });
            }
            else { alertify.alert("@EventManager1.Resource.ResourceStrings.allfieldrequired"); }
        }

    </script>
    <script src="~/Areas/js/map.js"></script>
    <script>

        $(document).ready(function () {
            var id= '@ViewBag.id'
            if (id!= '') {
                debugger;
                var id =  '@ViewBag.id' ;
                $.ajax({
                    url: '@Url.Action("geteventbyid", "User", new { area = "User" })',
                    type: "POST",
                    dataType: 'json',
                    data: {id :id},
                    success: function (result, i) {
                        debugger;
                        if (result != null) {
                            $('#eventid').val(result.Id);
                            $('#companyId').val(result.BusinessOwner_Id);
                            $('#EventName').val(result.EventName);
                            $('#StartDate').val(result.StartDate);
                            $('#PublishDate').val(result.PublishDate);
                            $('#StartTime').val(result.StartTime);
                            $('#EndDate').val(result.EndDate);
                            $('#EndTime').val(result.EndTime);
                            $('#Venue').val(result.Venue);
                            $('#CityName').val(result.CityName);
                            if (result.address_[0].Country > 0) {
                                $("#CountryId").val(result.address_[0].Country);
                            }
                            $('#Description').val(result.Description);
                            $("#AddressLine").val(result.address_[0].AddressLine);
                            var rlength = result.Multimedia.length;
                            if (rlength == 2) {
                                $("#img1").attr("src", result.Multimedia[0].URL);
                                $("#videopath").attr("src", result.Multimedia[1].URL);
                                if (result.Multimedia[1].URL != null && result.Multimedia[1].Mul_Type == 2) {
                                    var vido = result.Multimedia[1].URL;
                                    var arr = vido.split('.');
                                    const newString = vido.replace(arr[arr.length - 1], "ogg");
                                    $("#videogg").attr("src", newString);
                                    var video = document.getElementById("video1");
                                    video.autoplay = true;
                                    video.load();
                                }
                                //var vido = result.Multimedia[1].URL;
                                //var arr = vido.split('.');
                                //const newString = vido.replace(arr[arr.length - 1], "ogg");
                                //$("#videogg").attr("src", newString);
                                //var video = document.getElementById("video1");
                                //video.autoplay = true;
                                //video.load();

                            }
                            else if (rlength == 3) {
                                $("#img1").attr("src", result.Multimedia[0].URL);
                                $("#img1c").prop("checked", result.Multimedia[0].Mul_MainPic);
                                $("#img2").attr("src", result.Multimedia[1].URL);
                                $("#img2c").prop("checked", result.Multimedia[1].Mul_MainPic);
                                $("#videopath").attr("src", result.Multimedia[2].URL);
                                if (result.Multimedia[1].URL != null && result.Multimedia[1].Mul_Type == 2) {
                                    var vido = result.Multimedia[2].URL;
                                    var arr = vido.split('.');
                                    const newString = vido.replace(arr[arr.length - 1], "ogg");
                                    $("#videogg").attr("src", newString);
                                    var video = document.getElementById("video1");
                                    video.autoplay = true;
                                    video.load();
                                }
                                //var vido = result.Multimedia[2].URL;
                                //var arr = vido.split('.');
                                //const newString = vido.replace(arr[arr.length - 1], "ogg");
                                //$("#videogg").attr("src", newString);
                                //var video = document.getElementById("video1");
                                //video.autoplay = true;
                                //video.load();
                            }
                            else {
                                $("#img1").attr("src", result.Multimedia[0].URL);
                                $("#img1c").prop("checked", result.Multimedia[0].Mul_MainPic);
                                $("#img2").attr("src", result.Multimedia[1].URL);
                                $("#img2c").prop("checked", result.Multimedia[1].Mul_MainPic);
                                $("#img3").attr("src", result.Multimedia[2].URL);
                                $("#img3c").prop("checked", result.Multimedia[3].Mul_MainPic);
                                $("#videopath").attr("src", result.Multimedia[3].URL);
                                if (result.Multimedia[1].URL != null && result.Multimedia[1].Mul_Type == 2) {
                                    var vido = result.Multimedia[3].URL;
                                    var arr = vido.split('.');
                                    const newString = vido.replace(arr[arr.length - 1], "ogg");
                                    $("#videogg").attr("src", newString);
                                    var video = document.getElementById("video1");
                                    video.autoplay = true;
                                    video.load();
                                }
                                //var vido = result.Multimedia[3].URL;
                                //var arr = vido.split('.');
                                //const newString = vido.replace(arr[arr.length - 1], "ogg");
                                //$("#videogg").attr("src", newString);
                                //var video = document.getElementById("video1");
                                //video.autoplay = true;
                                //video.load();
                            }
                            
                            var rsvplength = result.Rsvp.length;
                           
                            if (rsvplength > 0) {
                               
                                $('#NamerRSVP').val(result.Rsvp[0].Namer); $('#PhoneRSVP').val(result.Rsvp[0].Phone);
                                if (rsvplength > 1) {
                                    for (var i = 0; i < rsvplength; i++) {
                                        if (i > 0) {
                                            var $newRow = $('#mainrow').clone().removeAttr('id');
                                            //Replace add button with remove button
                                            $('#add', $newRow).addClass('remove').val('Remove').removeClass('btn-success').addClass('btn-danger');

                                            //remove id attribute from new clone row
                                            $('#NamerRSVP,#PhoneRSVP', $newRow).removeAttr('id');
                                            $('.error', $newRow).remove();
                                            //append clone row
                                            $('#orderdetailsItems').append($newRow);                //clear select data
                                            $('#NamerRSVP,#PhoneRSVP').val('');
                                            $('#NamerRSVP').val(result.Rsvp[i].Namer); $('#PhoneRSVP').val(result.Rsvp[i].Phone);
                                        }
                                    }
                                }
                            }
                            GetLocations();

                        }

                        $("#FileUpload1").val('');
                        //alert(result);
                    },
                        error: function (err) {
                            alert(err.statusText);
                        }
                    });

            }
            $('#CountryId').on("change", function () {
                if (this.value) {
                    GetLocations();
                }
            });
            $('#CityName').on("change", function () {
                if (this.value) {
                    GetLocations();
                }
                $('#AddressLine').val('');
            });
            $('#AddressLine').on("change", function () {
                if (this.value) {
                    GetLocations();
                }
            });
            $('#lng').on("change", function () {
                var lat = $('#lat').val();
                if (this.value && lat) {
                    GetLocations();
                }
            });
            var img = "../../images/placeholder-image.jpg";
            $('#ImgRemove1').click(function () {
                $('#img1').attr('src', "").fadeOut();
                $('#img1').attr('src', img).fadeIn();
            });
            $('#ImgRemove2').click(function () {
                $('#img2').attr('src', "").fadeOut();
                $('#img2').attr('src', img).fadeIn();
            });
            $('#ImgRemove3').click(function () {               
                $('#img3').attr('src', "").fadeOut();
                $('#img3').attr('src', img).fadeIn();
            });
            $('#btnUpload').click(function () {
                //$('.datepicker').datepicker();
                // var $fileUpload = $("input[type='file']");
                var img = "../../images/placeholder-image.jpg";
                var img1 = $('#img1').attr('src');
                var img2 = $('#img2').attr('src');
                var img3 = $('#img3').attr('src');

                var $fileUpload = $('#FileUpload1');
                if (parseInt($fileUpload.get(0).files.length) < 1) {
                    alertify.alert("@EventManager1.Resource.ResourceStrings.selectimage");
                    return false;
                }
                if (parseInt($fileUpload.get(0).files.length) > 3) {
                    debugger;
                    alertify.alert("@EventManager1.Resource.ResourceStrings.maximgupload");
                    return false;
                }
                if (img1 != img && img2 != img && img3 != img) { alertify.alert("@EventManager1.Resource.ResourceStrings.maximgupload");}
                debugger;
                // Checking whether FormData is available in browser
                if (window.FormData !== undefined) {
                    Loader(true);
                    var fileUpload = $("#FileUpload1").get(0);
                    var files = fileUpload.files;

                    // Create FormData object
                    var fileData = new FormData();

                    // Looping over all files and add it to FormData object
                    for (var i = 0; i < files.length; i++) {
                        fileData.append(files[i].name, files[i]);
                    };

                    // Adding one more key to FormData object
                    //fileData.append('username','Session["name"]' );
                    debugger;
                    $.ajax({
                        url: '@Url.Action("UploadFiles", "User", new { area = "User" })',
                        type: "POST",
                        contentType: false, // Not to set any content header
                        processData: false, // Not to process data
                        data: fileData,
                        success: function (result) {
                            debugger;
                            for (var i = 0; i < result.length; i++) {
                                if (result[i] != null)
                                    Loader(false);
                                    if ($('#img1').attr('src') == img) {
                                        $("#img1").attr("src", result[i]);
                                    }
                                    else if ($('#img2').attr('src') == img) {
                                        $("#img2").attr("src", result[i]);
                                    }
                                    else if ($('#img3').attr('src') == img) { $("#img3").attr("src", result[i]); }
                                    else { alertify.alert("@EventManager1.Resource.ResourceStrings.maximgupload"); }

                            }
                            $("#FileUpload1").val('');
                            //alert(result);
                        },
                        error: function (err) {
                            Loader(false);
                            alert(err.statusText);
                        }
                    });
                } else {
                    alert("FormData is not supported.");
                }
            });

        });

        $('#btnUploadvid').click(function () {
            debugger;
            //var $fileUpload = $("input[type='file']");

            var files = $("#FileUpload2").get(0).files;
            if (parseInt(files.length) < 1) {
               alertify.alert("@EventManager1.Resource.ResourceStrings.selectvideo");
                return false;
            }

            // Checking whether FormData is available in browser
            if (window.FormData !== undefined) {
                Loader(true);
                var fileUpload = $("#FileUpload2").get(0);
                var files = fileUpload.files;

                // Create FormData object
                var fileData = new FormData();

                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                };

                // Adding one more key to FormData object
                fileData.append('username', 'Session["name"]');
                var vid = document.getElementById("videopath");
                var vogg = document.getElementById("videogg");

                $.ajax({
                    url: '@Url.Action("UploadFiles", "User", new { area = "User" })',
                    type: "POST",
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data
                    data: fileData,
                    success: function (result) {
                        debugger;
                        for (var i = 0; i < result.length; i++) {
                            if (result[i] != null)
                                var vido = result[i]
                            vid.src = vido;
                            var arr = vido.split('.');
                            const newString = vido.replace(arr[arr.length - 1], "ogg");
                            vogg.src = newString;
                            var video = document.getElementById("video1");
                            video.autoplay = true;
                            video.load();
                               // $("#videopath").attr("src", result[i]);                               '
                        }
                        Loader(false);
                    },
                    error: function (err) {
                        Loader(false);
                      alertify.alert(err.statusText);
                    }
                });
            } else {
                alert("FormData is not supported.");
            };
        });
        $('#add').click(function () {
            debugger;
            //validation and add order items
            var isAllValid = true;
            if (!($('#NamerRSVP').val().trim() != '' )) {
                isAllValid = false;
                $('#NamerRSVPerr').css('visibility', 'visible');
            }
            else {
                $('#NamerRSVPerr').css('visibility', 'hidden');
            }
            if (!($('#PhoneRSVP').val().trim() != '')) {
                isAllValid = false;
                $('#PhoneRSVPerr').css('visibility', 'visible');
            }
            else {
                $('#PhoneRSVPerr').css('visibility', 'hidden');
            }

            if (isAllValid) {
                var $newRow = $('#mainrow').clone().removeAttr('id');
                $('.name', $newRow).val($('#NamerRSVP').val());
                $('.phone', $newRow).val($('#PhoneRSVP').val());
                //Replace add button with remove button
                $('#add', $newRow).addClass('remove').val('Remove').removeClass('btn-success').addClass('btn-danger');

                //remove id attribute from new clone row
                $('#NamerRSVP,#PhoneRSVP', $newRow).removeAttr('id');
                $('.error', $newRow).remove();
                //append clone row
                $('#orderdetailsItems').append($newRow);                //clear select data
                $('#NamerRSVP,#PhoneRSVP').val('');
            }
        })
        $('#orderdetailsItems').on('click', '.remove', function () {
            $(this).parents('tr').remove();
        });
        $('#submit').click(function () {
            debugger;
            var isAllValid = validateform();
            if (isAllValid) {
                var radioValue = $("input[name='mainpic']:checked").val();
                var list = [];
                var img = "../../images/placeholder-image.jpg";
                var img11 = $('#img1').attr('src');
                var img1checked = false;
                if (radioValue == 'img1') { img1checked = true }
                var img21 = $('#img2').attr('src');
                var img2checked = false;
                if (radioValue == 'img2') { img2checked = true }
                var img31 = $('#img3').attr('src');
                var img3checked = false;
                if (radioValue == 'img2') { img3checked = true }
                var img1 = {
                    URL: $('#img1').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img1checked
                }
                if (img11 != img)
                    list.push(img1);
                var img2 = {
                    URL: $('#img2').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img2checked
                }
                if (img21 != img)
                    list.push(img2);
                var img3 = {
                    URL: $('#img3').attr('src'),
                    Mul_Type: 1,
                    Mul_MainPic: img3checked
                }
                if (img31 != img)
                    list.push(img3);
                var vid1 = {
                    URL: $('video').find('Source:first').attr('src'),
                    Mul_Type: 2
                }
                list.push(vid1);
                var Address = [];
                var addr = {
                    longitude: $('#lat').val(),
                    latitude: $('#lng').val(),
                    Country: $('#CountryId').val(),
                    City: $('#CityName').val(),
                    AddressLine: $('#AddressLine').val(),
                    ZipCode: $('#ZipCode').val()
                }
                Address.push(addr);
                var rsvp = [];
                var Rsvp = {
                    Namer: $('#NamerRSVP').val(),
                    Phone: $('#PhoneRSVP').val(),
                }
                if (Rsvp) {
                    rsvp.push(Rsvp);
                }
                $('#orderdetailsItems tbody tr').each(function (index, ele) {
                    var Rsvp1 = {
                        Namer: $('.name', this).val(),
                        Phone: $('.phone', this).val(),
                    }
                    rsvp.push(Rsvp1);
                })
                //validate order items
                debugger;

                var Register = {
                    Id: $('#eventid').val(),
                    User_Id: $('#companyId').val(),
                    EventName: $('#EventName').val(),
                    PublishDate: $('#PublishDate').val(),
                    StartDate: $('#StartDate').val(),
                    StartTime: $('#StartTime').val(),
                    EndDate: $('#EndDate').val(),
                    EndTime: $('#EndTime').val(),
                    Venue: $('#Venue').val(),
                    Description: $('#Description').val(),
                    address_: Address,
                    Multimedia: list,
                    Rsvp: rsvp
                }
                //$(this).val('Please wait...');
                debugger;
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CreateEvent", "User", new { area = "User" })',
                    data: '{Register: ' + JSON.stringify(Register) + '}',/* JSON.stringify(Register),*/
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (resp) {
                        if (resp.result.Code == 200) {
                            debugger;
                            //alert('Successfully saved');
                            //here we will clear the form
                            list = [];
                            $('#UserName,#ContactNo,#Email,#Password,#BusinessName,#CountryId,#Address,#ZipCode,#LastName,#FirstName,#PhoneNo,#confPassword').val('');
                            $('#orderdetailsItems').empty();
                            alertify.alert("Event Created Successfully.");
                            window.location.replace("../InvitationUser/Index");
                        }
                        else {

                            alertify.alert(resp.result.Msg);
                        }
                    },
                    error: function (error) {
                        debugger;
                        alertify.alert(error);
                    }
                });
            }
            else { alertify.alert("@EventManager1.Resource.ResourceStrings.allfieldrequired");}

        });
        function validateform()
        {
            var allvalid = true;
            if (!($('#EventName').val().trim() != '')) {
                allvalid = false;
                $('#Nameerr').css('visibility', 'visible');
            }
            else {
                $('#Nameerr').css('visibility', 'hidden');
            }
            debugger;

            if (!($('#AddressLine').val().trim() != '')) {
                allvalid = false;
                $('#addresserr').css('visibility', 'visible');
            }
            else {
                $('#addresserr').css('visibility', 'hidden');
            }
            if (!($('#Venue').val().trim() != '')) {
                allvalid = false;
                $('#Venueerr').css('visibility', 'visible');
            }
            else {
                $('#Venueerr').css('visibility', 'hidden');
            }
            if (!($('#CityName').val().trim() != '')) {
                allvalid = false;
                $('#Cityerr').css('visibility', 'visible');
            }
            else {
                $('#Cityerr').css('visibility', 'hidden');
            }
            if (!($('#Description').val().trim() != '')) {
                allvalid = false;
                $('#Descriptionerr').css('visibility', 'visible');
            }
            else {
                $('#Descriptionerr').css('visibility', 'hidden');
            }


            if (allvalid) {
                return true;
            }
            else { return false; };
           // CountryIderr CountryIderr address_  Venueerr Cityerr
        }
    </script>


}

@*<div class="mt-4">
        You can create tickets later from "Create Ticket Section"
        <a data-toggle="collapse" href="#collapseExample" aria-expanded="false"
           aria-controls="collapseExample">
            Do you want to create tickets right now? Click here
        </a>
        Or publish this Event
    </div>
    <div class="collapse" id="collapseExample">
        <div class="row mt-5">
            <div class="col-md-6">
                <label for="">Ticket type</label>
                <select class="form-control">
                    <option>Paid Ticket</option>
                    <option>Free</option>
                    <option>Type</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="">Ticket Name</label>
                <div class="input-group">
                    <input type="text" aria-label="" placeholder=""
                           class="form-control">
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-12">
                <div class="input-group">
                    <input type="number" aria-label="" placeholder="Seat "
                           class="form-control">
                    <input type="number" aria-label="" placeholder="Table "
                           class="form-control">
                    <input type="text" aria-label="" placeholder="Color Area"
                           class="form-control">
                    <input type="text" aria-label="" placeholder="Gate No"
                           class="form-control">
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-9">
                <div class="input-group">
                    <input type="text" aria-label="" placeholder="Price"
                           class="form-control">
                    <input type="text" aria-label="" placeholder="Fee"
                           class="form-control">
                    <input type="text" aria-label="" placeholder="Quantity"
                           class="form-control">
                </div>
            </div>
            <div class="col-md-3 text-center">
                <h4>
                    <a href=""><i class="mdi mdi-block-helper icon-md"></i></a>
                </h4>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 mt-4 mb-4">
                <a href="" class="btn btn-outline-primary btn-fw btn-block">
                    Add
                    More
                </a>
            </div>
        </div>
    </div>*@