@model EventManager1.Areas.Organizer.Models.Banner
@{
    ViewBag.Title = "Banner Setting";
    Layout = "~/Areas/Organizer/Views/Shared/_organizerLayout.cshtml";
}
<link href="~/DatePicker/jquery-timepicker-24-hour-format/dist/wickedpicker.min.css" rel="stylesheet" />
<link href="~/DatePicker/css/ui-lightness/jquery-ui-1.8.19.custom.css" rel="stylesheet" />
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css'>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css" />
<link href="~/css/toggleStyle.css" rel="stylesheet" />
<style type="text/css">
    @@media all and (min-width: 320px) and (max-width: 480px) {
        .content-wrapper {
            background: #f2edf3;
            padding: 2.75rem 1.25rem;
        }

        input#add {
            width: 100% !important;
        }
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        margin: 0;
    }

    .tag {
        top: 0px !important;
        right: 20px !important;
        opacity: 0.7;
        cursor: pointer;
    }

    .sidebar-offcanvas {
        height: auto !important;
    }

    #map {
        width: 100%;
        height: 450px;
    }

    .card .card-body {
        padding-bottom: 0.5rem;
    }

    .form-control {
        padding: 0.275rem 1.175rem !important;
    }

    .btn {
        padding: 0.585rem 1.0rem;
        /*background-color: transparent;*/
    }

    .error {
        color: red;
        visibility: hidden;
    }

    .imgbox {
        width: 100%;
        height: 100%;
        margin-bottom: 10px;
    }
</style>
<style>
    * {
        box-sizing: border-box;
    }

    body {
        background-color: #f1f1f1;
    }

    #regForm {
        background-color: #ffffff;
        margin: 0px auto;
        font-family: Raleway;
        padding: 40px;
        width: 100%;
        min-width: 300px;
    }

    h1 {
        text-align: center;
    }

    input {
        padding: 10px;
        width: 100%;
        font-size: 17px;
        font-family: Raleway;
        border: 1px solid #aaaaaa;
    }

        /* Mark input boxes that gets an error on validation: */
        input.invalid {
            border: 1px solid #e14949;
            /*background-color: #fbb2b2;*/
        }

        input#add {
            width: 15%;
        }

    /* Hide all steps by default: */
    .tab {
        display: none;
    }

    button {
        background-color: #4CAF50;
        color: #ffffff;
        border: none;
        padding: 10px 20px;
        font-size: 17px;
        font-family: Raleway;
        cursor: pointer;
    }

        button:hover {
            opacity: 0.8;
        }

    #prevBtn {
        background-color: #bbbbbb;
    }

    /* Make circles that indicate the steps of the form: */
    .step {
        height: 15px;
        width: 15px;
        margin: 0 2px;
        background-color: #bbbbbb;
        border: none;
        border-radius: 50%;
        display: inline-block;
        opacity: 0.5;
    }

        .step.active {
            opacity: 1;
        }

        /* Mark the steps that are finished and valid: */
        .step.finish {
            background-color: #4CAF50;
        }

    @@media screen and (min-width: 320px) and (max-width: 480px) {
        input#StartDate {
            width: 100%;
            margin-bottom: 10px;
        }

        input#EndDate {
            width: 100%;
            margin-bottom: 10px;
        }

        input#NamerRSVP {
            width: 100%;
            margin-bottom: 10px;
        }

        input.form-control.name {
            width: 100%;
            margin-bottom: 10px;
        }

        input#FileUpload1 {
            width: 100%;
            margin-bottom: 10px;
        }

        input#FileUpload2 {
            width: 100%;
            margin-bottom: 10px;
        }

        select#CountryId {
            width: 100%;
            margin-bottom: 10px;
        }

        input#lat {
            width: 100%;
            margin-bottom: 10px;
        }

        input#lng {
            width: 100%;
            margin-bottom: 10px;
        }

        input#CityName {
            width: 100%;
            margin-bottom: 10px;
        }

        input#AddressLine {
            width: 100%;
            margin-bottom: 10px;
        }

        input#Venue {
            width: 100%;
            margin-bottom: 10px;
        }
    }
</style>

<div class="content-wrapper">
    <input type="hidden" id="hfzipcode" />
    <div class="page-header">
        <h3 class="page-title">
            <span class="page-title-icon bg-gradient-primary text-white mr-2">
                <i class="mdi mdi-calendar-plus menu-icon"></i>
            </span>
            Create banner
        </h3>
    </div>


    @using (Html.BeginForm("SaveBannerbt", "Organizer", FormMethod.Post))
    {
        <div class="row">
            <div class="col-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="">Upload Image</label>
                                    <input type="file" id="FileUpload2" class="form-control file-upload-info" name="files1[]" />
                                    <span class="input-group-append">
                                        <input type="button" id="btnUpload" value="Upload Image" class="file-upload-browse btn btn-gradient-primary" style="width:50%" />
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div style="height:100px;margin-bottom:10px">
                                        <img src="@Model.ImagePath" id="img" class="imgbox" alt="" style="width:150px">
                                        <input type="hidden" value="@Model.ImagePath" name="ImagePath" id="ImagePath" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="">Start Date</label>
                                    <input type="text" id="StartDate" name="StartDate" value="@Model.StartDate" class="form-control" placeholder="Start Date" />
                                    <input type="hidden" id="ID" name="ID" value="@Model.ID" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="">End Date</label>
                                    <input type="text" id="EndDate" name="EndDate" value="@Model.EndDate" class="form-control" placeholder="End Date" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="">Start Time</label>
                                    <input type="text" id="StartTime" name="StartTime" value="@Model.StartTime" class="form-control" placeholder="Start Time" />

                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="">End Time</label>
                                    <input type="text" id="EndTime" name="EndTime" value="@Model.EndTime" class="form-control" placeholder="End Time" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="">Enable Timer</label>
                                    <label class="switch">
                                        @if (Model.IsTimeEnable == 0)
                                        {
                                            <input type="checkbox" id="Acknowledge" class="Acknowledge" checked="@Model.IsTimeEnable">
                                            <span class="slider round"></span>
                                        }
                                        else
                                        {
                                            <input type="checkbox" id="Acknowledge" class="Acknowledge">
                                            <span class="slider round"></span>
                                        }

                                    </label>
                                    @if (Model.IsTimeEnable == 0)
                                    {
                                        <input type="hidden" value="0" name="IsTimeEnable" id="IsTimeEnable" />
                                    }
                                    else
                                    {
                                        <input type="hidden" value="1" name="IsTimeEnable" id="IsTimeEnable" />
                                    }
                                   
                                </div>
                            </div>

                        </div>
                        <div class="col-md-4">
                            @if (Model.ID > 0)
                            {
                                <input type="submit" id="btnSave" class="btn btn-success" value="Update" />
                            }
                            else
                            {
                                <input type="submit" id="btnSave" class="btn btn-success" value="Save" />
                            }

                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="card">
        <div class="card-body">

            <div class="row">
                <div class="col-12 grid-margin stretch-card">
                    <table class="table table-striped" id="tblEnterPrisesList">
                        <thead style=" background #c598ff;">
                            <tr>
                                @*<th>Id</th>*@
                                <th>Image</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Manage Timer</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.BannerList != null)
                            {
                                foreach (var item in ViewBag.BannerList)
                                {
                                    <tr>
                                        @*<td>@item.Id</td>*@
                                        <td>
                                            <a href="@item.ImagePath" target="_blank">
                                                <img src="@item.ImagePath" class="" style="width:40px;height:40px;" />
                                            </a>
                                        </td>
                                        <td>@item.StartDate</td>
                                        <td>@item.EndDate</td>
                                        <td>@item.StartTime</td>
                                        <td>@item.EndTime</td>
                                        <td>
                                            @if (item.IsTimeEnable == 0)
                                            {
                                                <input type="checkbox" id="tblchkTimer" chkTimerId="@item.ID" checked class="checkbox chktime" />
                                            }
                                            else
                                            {
                                                <input type="checkbox" id="tblchkTimer" chkTimerId="@item.ID" class="checkbox chktime" />
                                            }

                                        </td>

                                        <td>
                                            <a href="/Organizer/Organizer/BannerSetting?Id=@item.ID" style="background: #f00;  color: #fff; padding: 10px;
        border-radius: 10px;"><i class="far fa-edit"></i></a>
                                        </td>
                                        <td>
                                            <a href="#" id="dlt" class="dlt" deleteId="@item.ID" style="background: #f00;  color: #fff; padding: 10px;
        border-radius: 10px;"><i class="fa fa-trash" aria-hidden="true"></i></a>
                                        </td>
                                    </tr>
                                }
                            }

                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>


<script src="~/DatePicker/js/jquery-1.7.2.min.js"></script>
<script src="~/DatePicker/js/jquery-ui-1.8.19.custom.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
@*<script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>*@
<script src="~/DatePicker/jquery-timepicker-24-hour-format/dist/wickedpicker.min.js"></script>
<script>
    $(document).ready(function () {
        $('#btnSave').click(function () {
            var startdate = $('#StartDate').val();
            var enddate = $('#EndDate').val();
            var starttime = $('#StartTime').val();
            var endtime = $('#EndTime').val();
            if (startdate == "") {
                alertify.alert('Please enter start date');
                return false;
            }
            if (enddate == "") {
                alertify.alert('Please enter end date');
                return false;
            }
            if (starttime == "") {
                alertify.alert('Please enter start time');
                return false;
            }
            if (endtime == "") {
                alertify.alert('Please enter end time');
                return false;
            }
        })
        //$('.dlt').click(function () {
        $("#tblEnterPrisesList tr td").on('click', '.dlt', function () {
            debugger
            Loader(true);
            //var id = $('#dlt').attr('deleteId');
            var id = $(this).attr('deleteId');
            var Banner = {
                Id: id,
            };
            if (id != null) {
                swal({
                    title: "Are you sure?",
                    text: "Once deleted, you will not be able to recover this banner !",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
 .then((willDelete) => {
     if (willDelete) {
         Loader(false);
         $.ajax({
             type: "POST",
             url: '@Url.Action("DeleteBanner", "Organizer", new { area = "Organizer" })',
             data: JSON.stringify(Banner),
             contentType: "application/json; charset=utf-8",
             dataType: "json",
             dataType: "json",
             success: function (Message) {
                 Loader(false);
                 if (Message != null) {
                     if (Message == "Delete") {
                         Loader(false);
                         swal({
                             title: "Deleted!",
                             text: "Deleted",
                             icon: "success",
                         });
                         window.location.reload();
                     }
                 }
             },
         });
     } else {
         Loader(false);
         swal("Your banner  is safe!");
     }
 });

            }
        });
        $(function () {
            $("#StartDate").datepicker();
            $("#EndDate").datepicker();
        });
        var twelveHour = $('.timepicker-12-hr').wickedpicker();
        $('.time').text('//JS Console: ' + twelveHour.wickedpicker('time'));
        $('#StartTime').wickedpicker({ twentyFour: true });
        $('#EndTime').wickedpicker({ twentyFour: true });
        //$('.timepicker-12-hr-clearable').wickedpicker({ clearable: true });

        @*$('#btnSave').click(function () {
            debugger
            var id = $('#dhnId').val();
            var logo = $('#FileUpload2').get(0).file;
            var startDate = $('#txtStartDate').val();
            var endDate = $('#txtEndDate').val();
            var startTime = $('#txtStartTime').val();
            var endTime = $('#txtEndTime').val();
            var EnableTimer;
            var EnableImg;
            if ($('#Acknowledge').prop("checked") == true) {
                EnableTimer = 0;
            }
            else if ($('#Acknowledge').prop("checked") == false) {
                EnableTimer = 1;
            }
            if ($('#chkimg').prop("checked") == true) {
                EnableImg = 0;
            }
            else if ($('#chkimg').prop("checked") == false) {
                EnableImg = 1;
            }
            if (startTime != "" && endTime != null) {
                var fileData = new FormData();
                fileData.append("Id", id);
                fileData.append("Image", logo[0]);
                fileData.append("StartDate", startDate);
                fileData.append("EndDate", endDate);
                fileData.append("StartTime", startTime);
                fileData.append("EndTime", endTime);
                fileData.append("IsTimeEnable", EnableTimer);
                fileData.append("IsImageEnble", EnableImg);
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("SaveBannerbt", "Organizer", new { area = "Organizer" })',
                    contentType: false,
                    processData: false,
                    data: fileData,
                    dataType: "json",
                    success: function (Message) {
                        Loader(false);
                        if (Message != null) {
                            if (Message == "Update") {
                                swal({
                                    title: "Good job!",
                                    text: "Update!",
                                    icon: "Update",
                                });
                                window.location.href = '/Organizer/Organizer/BannerTimer';

                            }
                            if (Message == "Success") {
                                swal({
                                    title: "Good job!",
                                    text: "Success!",
                                    icon: "Success",
                                });
                                window.location.reload();
                            }
                            if (Message == "Image Formate") {
                                swal({
                                    title: "Good job!",
                                    text: "Upload .jpg, .png , .gif, .jpeg Format Image!",
                                    icon: "Success",
                                });
                                window.location.reload();
                            }
                        } else {
                            swal({
                                title: "Something went wrong!",
                                text: "Something went wrong!",
                                icon: "warning",
                            });
                        }
                    },

                });
            }
            else {

                swal({
                    title: "Field Require!",
                    text: "Field Require!",
                    icon: "warning",
                });
                Loader(false);
            }

        })*@
        $('#Acknowledge').change(function () {
            if (this.checked) {
                $('#IsTimeEnable').val("0");
            }
            else { $('#IsTimeEnable').val("1"); }
        });

        $('.chktime').change(function () {
            debugger
            var EnableTmer;
            if ($(this).prop("checked") == true) {
                EnableTmer = 0;
            }
            else if ($(this).prop("checked") == false) {
                EnableTmer = 1;
            }
            var id = $(this).attr('chkTimerId');
            var Banner = {
                Id: id,
                EnableTimer: EnableTmer
            };
            if (id != null) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("EnableDisableBannerTimer", "Organizer", new { area = "Organizer" })',
                    data: JSON.stringify(Banner),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (Message) {
                        Loader(false);
                        if (Message != null) {
                            if (Message == "Delete") {
                                Loader(false);
                                window.location.reload();
                            }
                        }


                    },

                });
            }
        })
        $('#btnUpload').click(function () {
            debugger;
            Loader(true);
            //var $fileUpload = $("input[type='file']");
            var files = $("#FileUpload2").get(0).files;
            if (parseInt(files.length) < 1) {
                alertify.alert("Please select an image.");
                return false;
            }
            //var isvideo = isVideo(files[0].name);
            // Checking whether FormData is available in browser
            if (window.FormData !== undefined) {

                var fileUpload = $("#FileUpload2").get(0);
                var files = fileUpload.files;

                // Create FormData object
                var fileData = new FormData();

                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                };

                // Adding one more key to FormData object
                fileData.append('username', 'Session["name"]');
                Loader(true);
                $.ajax({
                    url: '@Url.Action("UploadBannerFiles", "Organizer", new { area = "Organizer" })',
                    type: "POST",
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data
                    data: fileData,
                    success: function (result) {
                        debugger;
                        for (var i = 0; i < result.length; i++) {
                            $("#img").attr("src", result[i]);
                            $("#ImagePath").val(result[i]);
                            Loader(false);
                        }
                    },
                    error: function (err) {
                        Loader(false);
                        alertify.alert(err.statusText);
                    }
                });
            } else {
                Loader(false);
                alert("FormData is not supported. Upload only .MP4 video");
            };
        });





    })
</script>

